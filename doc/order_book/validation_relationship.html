<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OrderBook Validator Hierarchy</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      font-size: 2.2em;
    }

    .hierarchy-section {
      margin-bottom: 40px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 20px;
      background: #fafafa;
    }

    .section-title {
      font-size: 1.5em;
      color: #2c3e50;
      margin-bottom: 20px;
      text-align: center;
      font-weight: bold;
    }

    .tree {
      font-family: monospace;
      font-size: 13px;
      line-height: 1.8;
      background: #2c3e50;
      color: #ecf0f1;
      padding: 25px;
      border-radius: 8px;
      overflow-x: auto;
      white-space: pre;
    }

    .factory { color: #e74c3c; font-weight: bold; }
    .builder { color: #3498db; font-weight: bold; }
    .validator { color: #2ecc71; font-weight: bold; }
    .step { color: #f39c12; }
    .result { color: #9b59b6; font-weight: bold; }
    .exception { color: #e67e22; }
    .calls { color: #95a5a6; }
    .creates { color: #1abc9c; }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
      justify-content: center;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 3px;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab {
      padding: 10px 20px;
      background: #ecf0f1;
      border: none;
      border-radius: 5px 5px 0 0;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    .tab.active {
      background: #3498db;
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .relationship-arrow {
      color: #95a5a6;
      font-weight: bold;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>🔍 OrderBook Validator Hierarchy & Relationships</h1>

  <div class="legend">
    <div class="legend-item">
      <div class="legend-color" style="background: #e74c3c;"></div>
      <span>Factory</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #3498db;"></div>
      <span>Builder</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #2ecc71;"></div>
      <span>Validator</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #f39c12;"></div>
      <span>Validation Step</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #9b59b6;"></div>
      <span>Result Object</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #e67e22;"></div>
      <span>Exception</span>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="showTab('validator-hierarchy')">Validator Hierarchy</button>
    <button class="tab" onclick="showTab('call-flow')">Validation Call Flow</button>
    <button class="tab" onclick="showTab('dependency-map')">Dependency Mapping</button>
  </div>

  <div id="validator-hierarchy" class="tab-content active">
    <div class="hierarchy-section">
      <div class="section-title">🏗️ Validator Class Hierarchy (Mirrors Domain Structure)</div>
      <div class="tree">
        <span class="factory">OrderBookManagerFactory</span> <span class="relationship-arrow">◄──[Top Level Factory]</span>
        ├── <span class="calls">calls</span> <span class="builder">OrderBookManagerBuilderValidation</span>
        │   ├── <span class="step">withOrderBooks(Map&lt;Symbol, OrderBook&gt;)</span>
        │   ├── <span class="step">validateSymbolUniqueness()</span>
        │   ├── <span class="step">validateOrderBookConsistency()</span>
        │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">OrderBookManagerValidationResult</span>
        │
        └── <span class="calls">delegates to</span> <span class="factory">OrderBookFactory</span> <span class="relationship-arrow">◄──[Per OrderBook]</span>
        ├── <span class="calls">calls</span> <span class="builder">OrderBookBuilderValidation</span>
        │   ├── <span class="step">withSymbol(Symbol)</span>
        │   ├── <span class="step">withInitialState()</span>
        │   ├── <span class="step">validateSymbolValidity()</span>
        │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">OrderBookValidationResult</span>
        │
        ├── <span class="calls">delegates to</span> <span class="validator">OrderAdditionValidator</span> <span class="relationship-arrow">◄──[Most Complex]</span>
        │   ├── <span class="calls">calls</span> <span class="builder">OrderAdditionBuilderValidation</span>
        │   │   ├── <span class="step">withOrderBook(OrderBook)</span>
        │   │   ├── <span class="step">withOrder(IOrder)</span>
        │   │   ├── <span class="step">validateOrderNotNull()</span>
        │   │   ├── <span class="step">validateOrderActivity()</span>
        │   │   ├── <span class="step">validateSymbolCompatibility()</span>
        │   │   ├── <span class="step">validateOrderUniqueness()</span>
        │   │   ├── <span class="step">validateOrderTypeCompatibility()</span>
        │   │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">OrderAdditionValidationResult</span>
        │   │
        │   ├── <span class="calls">delegates to</span> <span class="validator">PriceLevelValidator</span> <span class="relationship-arrow">◄──[Per Price Level]</span>
        │   │   ├── <span class="calls">calls</span> <span class="builder">PriceLevelBuilderValidation</span>
        │   │   │   ├── <span class="step">withPrice(Money)</span>
        │   │   │   ├── <span class="step">withOrderType(OrderType)</span>
        │   │   │   ├── <span class="step">withOrder(IOrder)</span>
        │   │   │   ├── <span class="step">validatePriceNotNull()</span>
        │   │   │   ├── <span class="step">validatePriceCompatibility()</span>
        │   │   │   ├── <span class="step">validateOrderTypePlacement()</span>
        │   │   │   ├── <span class="step">validateTimePriority()</span>
        │   │   │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">PriceLevelValidationResult</span>
        │   │   │
        │   │   └── <span class="calls">delegates to</span> <span class="validator">BookStateValidator</span>
        │   │       ├── <span class="calls">calls</span> <span class="builder">BookStateBuilderValidation</span>
        │   │       │   ├── <span class="step">withCurrentBook(OrderBook)</span>
        │   │       │   ├── <span class="step">withProposedChanges(OrderChange)</span>
        │   │       │   ├── <span class="step">validateVolumeConsistency()</span>
        │   │       │   ├── <span class="step">validateMarketStructure()</span>
        │   │       │   ├── <span class="step">validateSpreadIntegrity()</span>
        │   │       │   ├── <span class="step">validateIndexConsistency()</span>
        │   │       │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">BookStateValidationResult</span>
        │   │       │
        │   │       └── <span class="exception">throws BookStateValidationException</span>
        │   │
        │   └── <span class="exception">throws OrderAdditionValidationException</span>
        │
        ├── <span class="calls">delegates to</span> <span class="factory">OrderMatchFactory</span> <span class="relationship-arrow">◄──[Order Matching]</span>
        │   ├── <span class="calls">calls</span> <span class="builder">OrderMatchBuilderValidation</span>
        │   │   ├── <span class="step">withBuyOrder(IBuyOrder)</span>
        │   │   ├── <span class="step">withSellOrder(ISellOrder)</span>
        │   │   ├── <span class="step">validateOrdersNotNull()</span>
        │   │   ├── <span class="step">validateOrdersActive()</span>
        │   │   ├── <span class="step">validateSymbolCompatibility()</span>
        │   │   ├── <span class="step">validatePriceCompatibility()</span>
        │   │   ├── <span class="step">validateQuantityAvailability()</span>
        │   │   ├── <span class="step">validateTimePriorityRules()</span>
        │   │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">OrderMatchValidationResult</span>
        │   │
        │   └── <span class="exception">throws OrderMatchValidationException</span>
        │
        ├── <span class="calls">delegates to</span> <span class="factory">MarketDepthFactory</span> <span class="relationship-arrow">◄──[Market Queries]</span>
        │   ├── <span class="calls">calls</span> <span class="builder">MarketDepthBuilderValidation</span>
        │   │   ├── <span class="step">withSymbol(Symbol)</span>
        │   │   ├── <span class="step">withBidLevels(List&lt;BidPriceLevel&gt;)</span>
        │   │   ├── <span class="step">withAskLevels(List&lt;AskPriceLevel&gt;)</span>
        │   │   ├── <span class="step">withLevels(int)</span>
        │   │   ├── <span class="step">validateSymbolNotNull()</span>
        │   │   ├── <span class="step">validateLevelsPositive()</span>
        │   │   ├── <span class="step">validateLevelConsistency()</span>
        │   │   ├── <span class="step">validateSorting()</span>
        │   │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">MarketDepthValidationResult</span>
        │   │
        │   └── <span class="exception">throws MarketDepthValidationException</span>
        │
        └── <span class="calls">delegates to</span> <span class="factory">MarketOverviewFactory</span> <span class="relationship-arrow">◄──[Market Statistics]</span>
        ├── <span class="calls">calls</span> <span class="builder">MarketOverviewBuilderValidation</span>
        │   ├── <span class="step">withActiveSymbols(Set&lt;Symbol&gt;)</span>
        │   ├── <span class="step">withTotalOrderBooks(int)</span>
        │   ├── <span class="step">withTotalOrders(int)</span>
        │   ├── <span class="step">withTotalVolume(Map&lt;Symbol, BigDecimal&gt;)</span>
        │   ├── <span class="step">validateSymbolsNotNull()</span>
        │   ├── <span class="step">validateCountsNotNegative()</span>
        │   ├── <span class="step">validateVolumeConsistency()</span>
        │   └── <span class="step">build()</span> <span class="relationship-arrow">──▶</span> <span class="result">MarketOverviewValidationResult</span>
        │
        └── <span class="exception">throws MarketOverviewValidationException</span>
      </div>
    </div>
  </div>

  <div id="call-flow" class="tab-content">
    <div class="hierarchy-section">
      <div class="section-title">🔄 Validation Call Flow (Progressive Validation Chain)</div>
      <div class="tree">
        <span class="section-title">EXAMPLE: Adding Order to OrderBook</span>

        <span class="factory">OrderBookManager.addOrderToBook(order)</span>
        │
        ├── <span class="calls">1. Calls</span> <span class="validator">OrderAdditionValidator.validate(book, order)</span>
        │   │
        │   ├── <span class="calls">2. Creates</span> <span class="builder">OrderAdditionBuilderValidation.builder()</span>
        │   │   ├── <span class="step">3.1 withOrderBook(book)</span> <span class="relationship-arrow">─── Individual Validation</span>
        │   │   ├── <span class="step">3.2 withOrder(order)</span> <span class="relationship-arrow">─── Individual Validation</span>
        │   │   ├── <span class="step">3.3 validateOrderNotNull()</span> <span class="relationship-arrow">─── Individual Validation</span>
        │   │   ├── <span class="step">3.4 validateOrderActivity()</span> <span class="relationship-arrow">─── Individual Validation</span>
        │   │   ├── <span class="step">3.5 validateSymbolCompatibility()</span> <span class="relationship-arrow">─── Relational Validation</span>
        │   │   ├── <span class="step">3.6 validateOrderUniqueness()</span> <span class="relationship-arrow">─── Relational Validation</span>
        │   │   ├── <span class="step">3.7 validateOrderTypeCompatibility()</span> <span class="relationship-arrow">─── Relational Validation</span>
        │   │   │
        │   │   ├── <span class="calls">4. CASCADES TO</span> <span class="validator">PriceLevelValidator.validate(...)</span>
        │   │   │   │
        │   │   │   ├── <span class="calls">5. Creates</span> <span class="builder">PriceLevelBuilderValidation.builder()</span>
        │   │   │   │   ├── <span class="step">6.1 withPrice(order.getPrice())</span>
        │   │   │   │   ├── <span class="step">6.2 withOrderType(order.getType())</span>
        │   │   │   │   ├── <span class="step">6.3 validatePriceNotNull()</span>
        │   │   │   │   ├── <span class="step">6.4 validatePriceCompatibility()</span>
        │   │   │   │   ├── <span class="step">6.5 validateOrderTypePlacement()</span>
        │   │   │   │   ├── <span class="step">6.6 validateTimePriority()</span>
        │   │   │   │   │
        │   │   │   │   ├── <span class="calls">7. CASCADES TO</span> <span class="validator">BookStateValidator.validate(...)</span>
        │   │   │   │   │   │
        │   │   │   │   │   ├── <span class="calls">8. Creates</span> <span class="builder">BookStateBuilderValidation.builder()</span>
        │   │   │   │   │   │   ├── <span class="step">9.1 withCurrentBook(book)</span>
        │   │   │   │   │   │   ├── <span class="step">9.2 withProposedChanges(orderAddition)</span>
        │   │   │   │   │   │   ├── <span class="step">9.3 validateVolumeConsistency()</span>
        │   │   │   │   │   │   ├── <span class="step">9.4 validateMarketStructure()</span>
        │   │   │   │   │   │   ├── <span class="step">9.5 validateSpreadIntegrity()</span>
        │   │   │   │   │   │   ├── <span class="step">9.6 validateIndexConsistency()</span>
        │   │   │   │   │   │   └── <span class="step">9.7 build()</span> <span class="relationship-arrow">──▶</span> <span class="result">BookStateValidationResult</span>
        │   │   │   │   │   │
        │   │   │   │   │   └── <span class="calls">10. Returns</span> <span class="result">BookStateValidationResult</span>
        │   │   │   │   │
        │   │   │   │   └── <span class="step">6.7 build()</span> <span class="relationship-arrow">──▶</span> <span class="result">PriceLevelValidationResult</span>
        │   │   │   │
        │   │   │   └── <span class="calls">11. Returns</span> <span class="result">PriceLevelValidationResult</span>
        │   │   │
        │   │   └── <span class="step">3.8 build()</span> <span class="relationship-arrow">──▶</span> <span class="result">OrderAdditionValidationResult</span>
        │   │
        │   └── <span class="calls">12. Returns</span> <span class="result">OrderAdditionValidationResult</span>
        │
        ├── <span class="calls">13. If validation succeeds</span> <span class="relationship-arrow">──▶</span> <span class="creates">book.addOrder(order)</span>
        └── <span class="calls">14. If validation fails</span> <span class="relationship-arrow">──▶</span> <span class="exception">throw OrderAdditionValidationException</span>

        <span class="section-title">ERROR PROPAGATION CHAIN</span>

        <span class="exception">BookStateValidationException</span>
        └── <span class="calls">wraps into</span> <span class="exception">PriceLevelValidationException</span>
        └── <span class="calls">wraps into</span> <span class="exception">OrderAdditionValidationException</span>
        └── <span class="calls">wraps into</span> <span class="exception">OrderBookValidationException</span>
        └── <span class="calls">wraps into</span> <span class="exception">OrderBookManagerValidationException</span>
      </div>
    </div>
  </div>

  <div id="dependency-map" class="tab-content">
    <div class="hierarchy-section">
      <div class="section-title">🗺️ Validator Dependency Mapping</div>
      <div class="tree">
        <span class="section-title">VALIDATION DEPENDENCIES (Who Calls Whom)</span>

        <span class="factory">OrderBookManagerFactory</span>
        ├── <span class="calls">USES</span> <span class="factory">OrderBookFactory</span> <span class="relationship-arrow">◄── For each OrderBook</span>
        └── <span class="calls">USES</span> <span class="factory">MarketOverviewFactory</span> <span class="relationship-arrow">◄── For market statistics</span>

        <span class="factory">OrderBookFactory</span>
        ├── <span class="calls">USES</span> <span class="validator">OrderAdditionValidator</span> <span class="relationship-arrow">◄── Most frequent</span>
        ├── <span class="calls">USES</span> <span class="factory">OrderMatchFactory</span> <span class="relationship-arrow">◄── For order matching</span>
        └── <span class="calls">USES</span> <span class="factory">MarketDepthFactory</span> <span class="relationship-arrow">◄── For market depth queries</span>

        <span class="validator">OrderAdditionValidator</span>
        ├── <span class="calls">USES</span> <span class="validator">PriceLevelValidator</span> <span class="relationship-arrow">◄── For price level placement</span>
        └── <span class="calls">USES</span> <span class="validator">BookStateValidator</span> <span class="relationship-arrow">◄── For final consistency check</span>

        <span class="validator">PriceLevelValidator</span>
        └── <span class="calls">USES</span> <span class="validator">BookStateValidator</span> <span class="relationship-arrow">◄── For state consistency</span>

        <span class="section-title">CIRCULAR DEPENDENCY RESOLUTION</span>

        Problem: <span class="validator">OrderAdditionValidator</span> ↔ <span class="validator">PriceLevelValidator</span> ↔ <span class="validator">BookStateValidator</span>

        Solution: <span class="step">Linear Chain with Context Passing</span>
        <span class="validator">OrderAdditionValidator</span>
        └── <span class="calls">passes ValidationContext to</span> <span class="validator">PriceLevelValidator</span>
        └── <span class="calls">passes ValidationContext to</span> <span class="validator">BookStateValidator</span>
        └── <span class="calls">returns ValidationResult to</span> <span class="validator">PriceLevelValidator</span>
        └── <span class="calls">returns ValidationResult to</span> <span class="validator">OrderAdditionValidator</span>

        <span class="section-title">VALIDATION CONTEXT PATTERN</span>

        <span class="result">ValidationContext</span> <span class="relationship-arrow">◄── Shared across all validators</span>
        ├── <span class="step">OrderBook currentBook</span>
        ├── <span class="step">IOrder proposedOrder</span>
        ├── <span class="step">Map&lt;String, Object&gt; validationData</span>
        ├── <span class="step">List&lt;ValidationError&gt; accumulatedErrors</span>
        ├── <span class="step">ValidationPhase currentPhase</span>
        └── <span class="step">ValidationResult intermediateResults</span>

        <span class="section-title">REUSABILITY PATTERNS</span>

        <span class="step">Shared Validators:</span>
        ├── <span class="validator">SymbolValidator</span> <span class="relationship-arrow">◄── Used by multiple factories</span>
        ├── <span class="validator">PriceValidator</span> <span class="relationship-arrow">◄── Used by multiple validators</span>
        ├── <span class="validator">QuantityValidator</span> <span class="relationship-arrow">◄── Used by multiple validators</span>
        └── <span class="validator">OrderStateValidator</span> <span class="relationship-arrow">◄── Used by multiple validators</span>

        <span class="step">Composite Validators:</span>
        ├── <span class="validator">OrderCompatibilityValidator</span> <span class="relationship-arrow">◄── Combines multiple checks</span>
        ├── <span class="validator">MarketStructureValidator</span> <span class="relationship-arrow">◄── Combines multiple checks</span>
        └── <span class="validator">BookConsistencyValidator</span> <span class="relationship-arrow">◄── Combines multiple checks</span>
      </div>
    </div>
  </div>
</div>

<script>
  function showTab(tabName) {
    // Hide all tab contents
    const contents = document.querySelectorAll('.tab-content');
    contents.forEach(content => content.classList.remove('active'));

    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => tab.classList.remove('active'));

    // Show selected tab content
    document.getElementById(tabName).classList.add('active');

    // Add active class to clicked tab
    event.target.classList.add('active');
  }
</script>
</body>
</html>